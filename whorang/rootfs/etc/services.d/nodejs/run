#!/usr/bin/with-contenv bash
# ==============================================================================
# Home Assistant Add-on: WhoRang - Node.js Service
# ==============================================================================

# FIXED: Detect environment and use appropriate logging method
if command -v bashio >/dev/null 2>&1 && [ -n "${SUPERVISOR_TOKEN:-}" ]; then
    LOG_FUNC="bashio::log.info"
else
    LOG_FUNC="echo [INFO]"
fi

$LOG_FUNC "Starting WhoRang backend service..."

# Change to the app directory
cd /app || exit 1

# FIXED: Use standard HA addon user (abc) instead of whorun
# Execute the Node.js server with proper user and environment
exec s6-setuidgid abc node server.js
