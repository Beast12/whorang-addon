#!/usr/bin/with-contenv bashio
# ==============================================================================
# Home Assistant Add-on: WhoRang - Nginx Setup
# ==============================================================================

bashio::log.info "Setting up nginx for WhoRang addon..."

# FIXED: Nginx temp directories already created in Dockerfile with proper ownership
# No chown operations needed - directories created with correct permissions in build

# Test nginx configuration before starting
if nginx -t -c /etc/nginx/nginx.conf; then
    bashio::log.info "Nginx configuration is valid"
else
    bashio::log.error "Nginx configuration test failed!"
    exit 1
fi

# Ensure nginx directories exist (created in Dockerfile but verify)
if [[ ! -d "/tmp/nginx-client-body" ]]; then
    bashio::log.error "Nginx temp directories not found! Check Dockerfile setup."
    exit 1
fi

bashio::log.info "Nginx setup completed successfully"
